<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  
    <title>
      
        Rails 4 &middot; Vadim Brodsky
      
    </title>
  
    <link rel="stylesheet" href="/public/css/style.css">
    <!-- <link  href='http://rstacruz.github.io/flatdoc/v/0.8.6/theme-white/style.css' rel='stylesheet'> -->
  
  </head>

  <body class="page-note">
        
    <div class='header'>
          <div class='left'>
            <h1>Notes: Rails 4</h1>
            <ul>
              <li><a href='/'>Home</a></li>
              <li><a href='/notes'>Notes</a></li>
            </ul>
          </div>
          <div class='right'></div>
        </div>
        
        <div class='content-root'>
          <div class='menubar'>
            <div class='menu section' role='flatdoc-menu'></div>
          </div>
          <div role='flatdoc-content' class='content'><h1 id="installing-rails">Installing Rails</h1>

<ol>
<li>Install Bundler gem first.</li>
<li>Rehash the rbenv environment to load bundler.</li>
<li>Install the Rails gem.

<ul>
<li>Optionally install without docs: <code>--no-ri --no-rdoc</code></li>
<li>Install a specific version: <code>--version 4.0.0</code></li>
</ul></li>
<li>Install the MySQL gem.</li>
</ol>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">gem install bundler
rbenv rehash
bundle -v
gem install rails
rbenv rehash
rails -v
gem install mysql2
</code></pre></div>
<h1 id="creating-rails-project">Creating Rails Project</h1>

<ul>
<li>Navigate to the desired directory.</li>
<li>Run the <code>rails new project_name</code> command.</li>
<li>Can specify the database requirements with the <code>-d</code> flag.</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails new hello_app
rails new simple_cms -d mysql
</code></pre></div>
<h1 id="bundler">Bundler</h1>

<ul>
<li>Used to maintain project dependencies.</li>
<li>Can install with <code>--without production</code> to not install any  production gems in the development environment.</li>
<li>If the version of the Rails Gem was updated need to update with Bundler.</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">bundle install
bundle install --without production
bundle update rails
</code></pre></div>
<h1 id="accessing-a-project">Accessing a Project</h1>

<ul>
<li>Start the web server: <code>rails server</code> or <code>rails s</code>.</li>
<li>Visit the <code>localhost:3000</code> site in the browser.</li>
</ul>

<h1 id="rails-console">Rails Console</h1>

<ul>
<li>Rails comes with a modified version of IRB.</li>
<li>It has access to all of Rails methods and the app database.</li>
<li>By default it start in the development environment.</li>
<li>To start the console in a sandbox use the <code>--sandbox</code> flag, all changes will be rolled back on exit.</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails console
rails c
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rails console --sandbox
</code></pre></div>
<h1 id="generate">Generate</h1>

<ul>
<li>Rails <code>generate</code> command helps to create many things.</li>
<li>To list all of the thing that rails can generate, run <code>rails generate</code></li>
<li><code>rails generate GENERATOR [args] [options]</code></li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails generate
rails generate controller demo index
rails generate controller StaticPages home <span class="nb">help</span>
</code></pre></div>
<h1 id="undoing-rails-generated-code">Undoing Rails Generated Code</h1>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails generate controller FooBarz baz qux
rails destroy controller Foobarz
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rails generate model Foo bar:string baz:integer
rails destroy model Foo
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rake db:migrate
rake db:rollback
rake db:migrate <span class="nv">VERSION</span><span class="o">=</span>0
</code></pre></div>
<h1 id="scaffolding">Scaffolding</h1>

<ul>
<li>Rails has a scaffolding script that generates code for data models.</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails generate scaffold User name:string email:string
</code></pre></div>
<h1 id="database-migration">Database Migration</h1>

<ul>
<li>To update the database based on changes in the code run a migration.</li>
<li>To make sure that the right version of Rake runs use the <code>bundle exec</code> addition.</li>
<li>To see all available rake tasks run <code>bundle exec rake -T</code>.</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">bundle <span class="nb">exec </span>rake db:migrate
</code></pre></div>
<h1 id="rails-file-structure">Rails File Structure</h1>

<ul>
<li><code>app/</code> Most of the app code lives here</li>
<li><code>app/assets</code> application assets, processed by the Rails asset pipeline</li>
<li><code>app/assets/images</code></li>
<li><code>app/assets/javascripts</code></li>
<li><code>app/assets/stylesheets</code></li>
<li><code>app/controllers</code> the controllers</li>
<li><code>app/controllers/concerns</code> common code that shared between controllers</li>
<li><code>app/helpers</code> code that helps with views</li>
<li><code>app/mailers</code> sending emails</li>
<li><code>app/models</code> the models</li>
<li><code>app/models/concerns</code> common code that shared between models</li>
<li><code>app/views</code> the views</li>
<li><code>bin/</code> stores the Rails commands and other binary executables</li>
<li><code>config/</code> Configuration files for the application</li>
<li><code>config/environments</code> settings for different environments</li>
<li><code>config/initializers</code> differing this that launch when app launches</li>
<li><code>config/locales</code> translation and internationalization</li>
<li><code>db/</code> code related to managing the database and db migrations</li>
<li><code>doc/</code> documentation for the app</li>
<li><code>lib/</code> storing libraries of code</li>
<li><code>lib/assets</code> different assets from library modules</li>
<li><code>lib/tasks</code>  rake tasks for the library modules</li>
<li><code>log/</code> application log files</li>
<li><code>public/</code> data accessible to the public, such as html error pages</li>
<li><code>test/</code> application tests</li>
<li><code>tmp/</code> temporary files that Rails generates</li>
<li><code>vendor/</code> third party plugin code that is not in gems</li>
<li><code>README.rdoc</code> A brief description of the application</li>
<li><code>Rakefile</code> Utility tasks available via the <code>rake</code> command</li>
<li><code>Gemfile</code> Gem requirements for the app</li>
<li><code>Gemfile.lock</code> A list of gems and their dependencies</li>
<li><code>config.ru</code> A configuration file for Rack Middleware</li>
<li><code>.gitignore</code> Patterns for files that should be ignored by Git.</li>
</ul>

<h1 id="rest-architecture">REST Architecture</h1>

<ul>
<li>Representational State Transfer.</li>
<li>REST is an architectural style for developing distributed, networked systems and software applications.</li>
<li>In the context of Rails applications REST means that most application components are modeled as resources that can be:

<ul>
<li>Created, read, updated, and deleted—operations that correspond both to the CRUD operations of relational databases</li>
<li>Four fundamental HTTP request methods: <code>POST</code>, <code>GET</code>, <code>PATCH</code>, and <code>DELETE</code>.</li>
</ul></li>
</ul>

<h1 id="http-operations">HTTP Operations</h1>

<ul>
<li><code>GET</code> is the most common HTTP operation, used for reading data on the web; it just means “get a page”,</li>
<li><code>POST</code> is the next most common operation; it is the request sent by your browser when you submit a form. In Rails applications, <code>POST</code> requests are typically used for creating things.</li>
<li><code>PATCH</code> and <code>DELETE</code>, are designed for updating and destroying things on the remote server. These requests are less common than <code>GET</code> and <code>POST</code> since browsers are incapable of sending them natively.</li>
</ul>

<h1 id="test-driven-development">Test Driven Development</h1>

<ul>
<li>Behavior-driven development (BDD) is a variant of test-driven development (TDD) that emphasizes the behavior of the application rather than its precise implementation.</li>
<li>Integration tests: known as request specs in the context of RSpec, allow us to simulate the actions of a user interacting with our application using a web browser.</li>
<li>The defining quality of TDD is writing tests first, before the application code.</li>
<li>By writing a failing test first and then implementing the application code to get it to pass, we increase our confidence that the test is actually covering the functionality we think.</li>
<li>When you aren’t at all sure how to solve a given programming problem, it’s often useful to skip the tests and write only application code, just to get a sense of what the solution will look like.</li>
<li>Once you see the general shape of the solution, you can then use TDD to implement a more polished version.</li>
</ul>

<h1 id="red-green-refactor">Red, Green, Refactor</h1>

<ul>
<li>First write a failing test, represented in many testing tools by the color red.</li>
<li>Implement code to get the test to pass, represented by the color green.</li>
<li>Refactor the code, changing its form without changing its function.</li>
</ul>

<h1 id="request-spec">Request Spec</h1>

<ul>
<li>Integration tests (request spec) are done with Rspec in Rails.</li>
<li>Rails creates these tests in the <code>spec/requests/</code> folder.</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails generate integration_test static_pages
</code></pre></div>
<h2 id="writing-the-test">Writing the Test</h2>

<ul>
<li>RSpec uses the general malleability of Ruby to define a domain-specific language (DSL) built just for testing.</li>
<li>The <code>describe</code> lines are for human readers only.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"> <span class="c1"># spec/requests/static_pages_spec.rb</span>
<span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s2">&quot;Home Page&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="running-the-test">Running the Test</h2>

<ul>
<li>To get the test to run need to add the Capybara DSL to the RSpec helper file.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"> <span class="c1"># spec/spec_helper.rb</span>
 <span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
   <span class="o">.</span>
   <span class="o">.</span>
   <span class="o">.</span>
   <span class="n">config</span><span class="o">.</span><span class="n">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>
 <span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
bundle <span class="nb">exec </span>rspec spec
bundle <span class="nb">exec </span>rake spec
</code></pre></div>
<h1 id="embedded-ruby-erb">Embedded Ruby - ERb</h1>

<ul>
<li>ERb is the primary template system in Rails.</li>
<li>The <code>&lt;% ... %&gt;</code> tag executes the code inside.</li>
<li>The <code>&lt;%= ... %&gt;</code> tag executes and inserts the result into the template.</li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;body&gt;</span>
<span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/body&gt;</span>
</code></pre></div>
<h2 id="erb-helper-yield">ERb Helper: Yield</h2>

<ul>
<li>The <code>yield</code> method inserts the contents of each page into the site layout.</li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;div class=&quot;container&quot;&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div>
<h2 id="erb-helper-link_to">ERb Helper: Link_To</h2>

<ul>
<li>Rails helper <code>link_to</code> creates links as anchor tags.</li>
<li><code>&lt;%= link_to &quot;link text&quot;, &#39;url&#39;, {options: &quot;hash&quot;} %&gt;</code></li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h2 id="erb-helper-image_tag">ERb Helper: Image_Tag</h2>

<ul>
<li>Rails helper <code>image_tag</code> creates an <code>img</code> tag.</li>
<li>Rails will always include an <code>alt</code> attribute even if one wasn&rsquo;t given, using the filename.</li>
<li>Rails knows to look for images in the <code>/app/assets/images/</code> folder.</li>
<li><code>&lt;%= image_tag(&quot;file_name.jpg&quot;, options: &quot;hash&quot;) %&gt;</code></li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">&quot;rails.png&quot;</span><span class="p">,</span> <span class="ss">alt</span><span class="p">:</span> <span class="s2">&quot;Rails&quot;</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">&quot;rails.png&quot;</span><span class="p">,</span> <span class="ss">alt</span><span class="p">:</span> <span class="s2">&quot;Rails&quot;</span><span class="p">),</span> <span class="s1">&#39;http://rubyonrails.org/&#39;</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h2 id="erb-helper-render">ERb Helper: Render</h2>

<ul>
<li>Used to render partials in ERb files.</li>
<li>Partials are usually named with a leading <code>_</code>.</li>
<li>Examples: <code>/app/views/layouts/_shim.html.erb</code>.</li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h2 id="erb-debug-information">ERb Debug Information</h2>

<ul>
<li>Add this to the view template to see debug info.</li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">debug</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h2 id="erb-forms">ERb Forms</h2>

<ul>
<li>Rails has a built-in <code>form_for</code> function.</li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:email</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="s2">&quot;Confirmation&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password_confirmation</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">&quot;Create my account&quot;</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-large btn-primary&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h1 id="asset-pipeline">Asset Pipeline</h1>

<ul>
<li>Improves production and management of static assets such as CSS, JavaScript and Images.</li>
<li>Primary 3 features: asset directories, manifest files, and pre-processor engines.</li>
<li>With the asset pipeline, in production all the application stylesheets get rolled into <code>application.css</code>, all the application JavaScript code gets rolled into <code>javascripts.js</code>, and all such files (including those in lib/assets and vendor/assets) are minified.</li>
</ul>

<h2 id="asset-pipeline-asset-directories">Asset Pipeline: Asset Directories</h2>

<ul>
<li><code>app/assets</code>: assets specific to the current application.</li>
<li><code>lib/assets</code>: assets for libraries written by your dev team.</li>
<li><code>vendor/assets</code>: assets from third-party vendors.</li>
</ul>

<h2 id="asset-pipeline-manifest-files">Asset Pipeline: Manifest Files</h2>

<ul>
<li>Once the assets are in their logical locations, you can use manifest files to tell Rails (via the Sprockets gem) how to combine them to form single files. </li>
<li>This applies to CSS and JavaScript but not to images.</li>
<li><code>/app/assets/stylesheets/application.css</code>

<ul>
<li><code>*= require_tree .</code>: ensures that all CSS files in the current directory (including the tree subdirectories) are included into the application CSS.</li>
<li><code>*= require_self</code>: specifies where in the loading sequence the CSS in <code>application.css</code> itself gets included.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/*</span>
<span class="c"> *= require_self</span>
<span class="c"> *= require_tree .</span>
<span class="c"> */</span>
</code></pre></div>
<h2 id="asset-pipeline-preprocessor-engines">Asset Pipeline: Preprocessor Engines</h2>

<ul>
<li>We tell Rails which processor to use using filename extensions.</li>
<li>The preprocessor engines can be chained, with the code running from right to left.</li>
<li>This is achieved with the correct file extensions.</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">foobar.js.coffee -- run through CoffeeScript processor
foobar.js.erb.coffee -- run through CoffeeScript and ERb
</code></pre></div>
<h1 id="rails-server-request-handling">Rails Server Request Handling</h1>

<ul>
<li>Browser =&gt; Web Server =&gt; Public =&gt; Rails Framework</li>
<li>If the request is satisfied by the public static file the Rails framework would not be accessed.</li>
</ul>

<h1 id="rails-routes">Rails Routes</h1>

<ul>
<li>Rails Routing =&gt; Controller =&gt; Model =&gt; Database =&gt; Controller =&gt; View</li>
<li>To see all of the active routes in the app use <code>rake routes</code> command</li>
<li>Routes are processed top-top-bottom in the <code>routes.rb</code> file.</li>
<li>Basic route types:

<ul>
<li>Simple route (match route)</li>
<li>Default route</li>
<li>Root route</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rake routes
</code></pre></div>
<h2 id="simple-match-route">Simple, Match Route</h2>

<ul>
<li>Matching the string and sends it to the controller and action via get.</li>
<li>Not very flexible.</li>
<li>This also creates a named routes for use in controllers and views: <code>about_path</code> and <code>about_url</code>.

<ul>
<li>For most app link use <code>path</code>.</li>
<li>For redirects use <code>url</code>.</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s2">&quot;demo/index&quot;</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">match</span> <span class="s2">&quot;demo/index&quot;</span><span class="p">,</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">&quot;demo#index&quot;</span><span class="p">,</span> <span class="ss">:via</span> <span class="o">=&gt;</span> <span class="ss">:get</span>
<span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;static_pages#about&#39;</span><span class="p">,</span> <span class="n">via</span> <span class="p">:</span> <span class="s1">&#39;get&#39;</span>
</code></pre></div>
<h2 id="default-route">Default Route</h2>

<ul>
<li>More generic routing rule.</li>
<li>Uses a Regex match function.</li>
<li>Can also pass a format for file type (json, xml etc.)</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">:controller</span><span class="o">/</span><span class="ss">:action</span><span class="o">/</span><span class="ss">:id</span>
<span class="n">match</span> <span class="s1">&#39;:controller(/:action(/:id))&#39;</span><span class="p">,</span> <span class="ss">:via</span> <span class="o">=&gt;</span> <span class="ss">:get</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">match</span> <span class="s1">&#39;:controller(/:action(/:id(.:format)))&#39;</span><span class="p">,</span> <span class="p">;</span><span class="n">via</span> <span class="o">=&gt;</span> <span class="ss">:get</span>
</code></pre></div>
<h2 id="root-route">Root Route</h2>

<ul>
<li>When you go to the root of the application and have nothing to match.</li>
<li>Homepage of the application.</li>
<li>Use the <code>root</code> method.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">&quot;demo#index&quot;</span>
<span class="n">root</span> <span class="s2">&quot;demo#index&quot;</span>
<span class="n">root</span> <span class="s1">&#39;static_pages#home&#39;</span>
</code></pre></div>
<h1 id="models">Models</h1>

<ul>
<li>Communicates and abstracts the database.</li>
<li>Solves the persistence problem.</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails generate controller Users new
rails generate controller Users new --no-test-framework
rails generate model User name:string email:string
</code></pre></div>
<h2 id="migrate-file">Migrate File</h2>

<ul>
<li>Migrations provide a way to alter the structure of the database incrementally, so that our data model can adapt to changing requirements.</li>
<li>Migration file is prefixed by a timestamp based on when the migration was generated.</li>
<li><code>/db/migrate/[timestamp]_create_users.rb</code></li>
<li>The migration consists of a <code>change</code> method that determines the change to be made to the database.</li>
<li><code>t.timestamps</code>: is a special command that creates two columns called <code>created_at</code> and <code>updated_at</code>, which are timestamps that automatically record when a given user is created and updated.</li>
<li>We can run the migration, known as “migrating up”, using the rake command.</li>
<li>Most migrations are reversible, which means we can “migrate down” and undo them with a single Rake task, called <code>db:rollback</code>.</li>
<li><code>rake test:prepare</code>: ensures that the data model from the development database, <code>db/development.sqlite3, is reflected in the test database</code>db/test.sqlite3`, assuming that SQLite is used locally.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:email</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">bundle <span class="nb">exec </span>rake db:migrate
bundle <span class="nb">exec </span>rake db:rollback
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">bundle <span class="nb">exec </span>rake <span class="nb">test</span>:prepare
</code></pre></div>
<h2 id="model-file">Model File</h2>

<ul>
<li>Model files are stores in <code>app/models/</code>.</li>
<li><code>User.new</code>: creates a new user object.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user1</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">&quot;jd@email.com&quot;</span><span class="p">)</span>
<span class="n">user1</span><span class="o">.</span><span class="n">save</span>
<span class="n">user1</span><span class="o">.</span><span class="n">name</span>          <span class="c1">#=&gt; &quot;John Doe&quot;</span>
<span class="n">user2</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">&quot;janed@mail.com&quot;</span><span class="p">)</span>
<span class="n">user1</span><span class="o">.</span><span class="n">destroy</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="no">User</span><span class="o">.</span><span class="n">find_by_email</span><span class="p">(</span><span class="s2">&quot;jd@email.com&quot;</span><span class="p">)</span>
<span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s2">&quot;jd@email.com&quot;</span><span class="p">)</span>  <span class="c1"># Rails 4.0 preferred method</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="no">User</span><span class="o">.</span><span class="n">all</span>
<span class="no">User</span><span class="o">.</span><span class="n">count</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user1</span>
<span class="n">user1</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;test@test.com&quot;</span>
<span class="c1"># user1.reload.email</span>
<span class="n">user1</span><span class="o">.</span><span class="n">save</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user2</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Jenny Doe&quot;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">&quot;jend@mail.com&quot;</span><span class="p">)</span>
<span class="n">user2</span><span class="o">.</span><span class="n">update_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="validations-presence">Validations: Presence</h2>

<ul>
<li>Checks if the data entered is not blank.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#/app/models/user.rb</span>
<span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user</span><span class="o">.</span><span class="n">valid?</span>
<span class="n">user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span>
</code></pre></div>
<h2 id="validations-length">Validations: Length</h2>

<ul>
<li>Checks the length of the entered data.</li>
<li>Using the <code>:length</code> and the <code>:maximum</code> parameters.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#/app/models/user.rb</span>
<span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
</code></pre></div>
<h2 id="validations-pattern">Validations: Pattern</h2>

<ul>
<li>Checks if the input matches a certain pattern.</li>
<li>Uses RegEx for pattern matching.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
<span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">}</span>
</code></pre></div>
<h2 id="validations-uniqueness">Validations: Uniqueness</h2>

<ul>
<li>Checks whether the input is already entered in the database.</li>
<li>Can pass an optional <code>case_sensitive</code> parameter.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span>
<span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span><span class="p">}</span>
</code></pre></div>
<h2 id="password">Password</h2>

<ul>
<li>Use <code>bcrypt-ruby</code> gem for password hashing.</li>
<li>Add <code>password_digest</code> column to the table.</li>
<li>Use the <code>has_secure_password</code> function.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#Gemfile</span>
<span class="n">gem</span> <span class="s1">&#39;bcrypt-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;3.1.2&#39;</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">bundle install
rails generate migration add_password_digest_to_users password_digest:string
bundle <span class="nb">exec </span>rake db:migrate
bundle <span class="nb">exec </span>rake <span class="nb">test</span>:prepare
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#/app/models/user.rb</span>
<span class="n">has_secure_password</span>
</code></pre></div>
<h1 id="controller">Controller</h1>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>
        </div>    

  </body>

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-31685503-1', 'auto');
  ga('send', 'pageview');
</script>
</html>
